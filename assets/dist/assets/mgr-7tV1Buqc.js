import{d as M,z as x,B as j,g as D,o as y,c as h,i as B,f as V,q as o,w as s,u as t,e as U,h as q,V as W,F as H,p as O,A,b as C,a6 as $,m as E,ab as N,G as J,H as Y,y as Z}from"./vue-hfjAzT99.js";import{a as S,c as ee,b as te}from"./vue-router-Cb_WVhdP.js";import{o as G,d as le,Q as L,B as Q,V as oe}from"./vesp-HQBszzT3.js";import{w as ne,g as se,d as ae,A as de,$ as ie,k as re,z as ue,X as me,m as ce,v as pe,L as _e}from"./vue-bootstrap-CJ-2MBel.js";import{E as F,c as _,P as fe}from"./api-CKyfD95E.js";const ve={class:"overflow-auto vh-100 p-3"},xe={class:"d-flex align-items-center gap-1"},ye={class:"m-0"},Ve={key:0,class:"small text-secondary"},be={key:0},ke={class:"small text-secondary"},ge={class:"main-wrapper mb-md-5"},he=M({__name:"app",setup(g){const i=[{title:"models.index.title_many",route:"index"}],m=x(),n=x();return j(async()=>{try{const e=await F("mgr/version");e.current&&(m.value=e.current),e.available&&(n.value=e.available)}catch{}}),(e,u)=>{const d=ne,c=se,r=D("RouterView");return y(),h("div",ve,[B("div",xe,[B("h4",ye,V(e.$t("menu_name")),1),o(W,{name:"fade"},{default:s(()=>[t(m)?(y(),h("div",Ve,[U(V(t(m))+" ",1),t(n)?(y(),h("sup",be,V(e.$t("version.available",{version:t(n)})),1)):q("",!0)])):q("",!0)]),_:1})]),B("div",ke,V(e.$t("menu_desc")),1),o(c,{tabs:"",class:"mt-3"},{default:s(()=>[(y(),h(H,null,O(i,(w,b)=>o(d,{key:b,to:{name:w.route}},{default:s(()=>[U(V(e.$t(w.title)),1)]),_:2},1032,["to"])),64))]),_:1}),B("div",ge,[o(r)])])}}}),we=(g,i)=>{const m=g.__vccOpts||g;for(const[n,e]of i)m[n]=e;return m},$e=we(he,[["__scopeId","data-v-809b99db"]]),ze={key:0,class:"icon icon-check"},Be={key:1,class:"icon icon-times"},Ue={class:"text-center my-5"},Ae={key:0,class:"mt-5"},Ce="mgr/indexes",Me=M({__name:"index",setup(g){const i=x(),m=A(()=>[{route:{name:"index-create"},icon:"plus",title:_("models.index.title_one")}]),n=A(()=>[{key:"id",label:_("models.index.id"),sortable:!0},{key:"title",label:_("models.index.title"),sortable:!0},{key:"prefix",label:_("models.index.prefix"),sortable:!0},{key:"fuzzy",label:_("models.index.fuzzy"),sortable:!0},{key:"context_key",label:_("models.index.context_key"),sortable:!0}]),e=A(()=>{var l;return[{function:b,icon:"sync",title:_("actions.update")},{route:{name:"index-id-view"},icon:"eye",title:_("actions.view")},{route:{name:"index-id-edit"},icon:"edit",title:_("actions.edit")},{function:(l=i.value)==null?void 0:l.delete,icon:"times",title:_("actions.delete"),variant:"danger"}]}),u=x({query:""}),d=x(!1),c=x(0),r=x(0);function w(l){return l&&!l.active?"inactive":""}async function b(l,a=0){try{d.value=!0;const f=await fe("mgr/indexes/"+l.id,{offset:a});c.value=f.total,r.value+=f.indexed,f.total>r.value&&await b(l,r.value),i.value.refresh(),c.value=0,r.value=0}catch{c.value=0,r.value=0}finally{d.value=!1}}return(l,a)=>{const f=D("RouterView"),k=ae,R=de,v=G;return y(),C(v,E({ref_key:"table",ref:i},{url:Ce,fields:t(n),headerActions:t(m),tableActions:t(e),filters:t(u),rowClass:w}),{"cell(prefix)":s(({value:z})=>[z?(y(),h("i",ze)):(y(),h("i",Be))]),default:s(()=>[o(f),o(R,{modelValue:t(d),"onUpdate:modelValue":a[0]||(a[0]=z=>$(d)?d.value=z:null),"teleport-disabled":"","hide-footer":"","hide-header":"","no-close-onbackdrop":""},{default:s(()=>[B("div",Ue,[o(k),t(c)?(y(),h("div",Ae,"Indexed "+V(t(r))+" from "+V(t(c)),1)):q("",!0)])]),_:1},8,["modelValue"])]),_:1},16)}}}),Re=B("i",{class:"icon icon-times fa-fw"},null,-1),Ie=B("i",{class:"icon icon-check fa-fw"},null,-1),X=M({__name:"index",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(g,{emit:i}){const m=g,n=i,e=A({get(){return m.modelValue},set(l){n("update:modelValue",l)}}),u=x(""),d=x("1"),c=A(()=>u.value.length&&d.value&&e.value.fields.findIndex(l=>l.field===u.value)===-1);function r(){c.value&&(e.value.fields.push({field:u.value,weight:d.value}),u.value="",d.value="1")}function w(l){e.value.fields.splice(l,1)}function b(l){l.key==="Enter"&&(l.preventDefault(),r())}return(l,a)=>{const f=ie,k=re,R=le,v=ue,z=me,K=ce,P=pe;return y(),h("div",null,[o(k,{label:l.$t("models.index.title")},{default:s(()=>[o(f,{modelValue:t(e).title,"onUpdate:modelValue":a[0]||(a[0]=p=>t(e).title=p),required:""},null,8,["modelValue"])]),_:1},8,["label"]),o(k,{label:l.$t("models.index.context_key")},{default:s(()=>[o(R,{modelValue:t(e).context_key,"onUpdate:modelValue":a[1]||(a[1]=p=>t(e).context_key=p),url:"mgr/modx/contexts","value-field":"key","text-field":"name","force-select":"",required:""},null,8,["modelValue"])]),_:1},8,["label"]),o(k,{description:l.$t("models.index.field_desc")},{default:s(()=>[o(z,null,{default:s(()=>[o(v,{cols:"6"},{default:s(()=>[U(V(l.$t("models.index.field")),1)]),_:1}),o(v,{cols:"6"},{default:s(()=>[U(V(l.$t("models.index.weight")),1)]),_:1})]),_:1}),(y(!0),h(H,null,O(t(e).fields,(p,T)=>(y(),C(z,{key:T,class:"mt-2"},{default:s(()=>[o(v,{cols:"6"},{default:s(()=>[o(f,{modelValue:p.field,"onUpdate:modelValue":I=>p.field=I,size:"sm",disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(v,{cols:"6",class:"d-flex align-items-center"},{default:s(()=>[o(f,{modelValue:p.weight,"onUpdate:modelValue":I=>p.weight=I,type:"number",size:"sm",min:"1",step:"1"},null,8,["modelValue","onUpdate:modelValue"]),o(K,{size:"sm",class:"ms-2",onClick:I=>w(T)},{default:s(()=>[Re]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),o(z,{class:"mt-2 align-items-center"},{default:s(()=>[o(v,{cols:"6"},{default:s(()=>[o(f,{modelValue:t(u),"onUpdate:modelValue":a[2]||(a[2]=p=>$(u)?u.value=p:null),size:"sm",onKeydown:b},null,8,["modelValue"])]),_:1}),o(v,{cols:"6",class:"d-flex align-items-center"},{default:s(()=>[o(f,{modelValue:t(d),"onUpdate:modelValue":a[3]||(a[3]=p=>$(d)?d.value=p:null),type:"number",size:"sm",min:"1",step:"1",onKeydown:b},null,8,["modelValue"]),o(K,{size:"sm",class:"ms-2",disabled:!t(c),onClick:r},{default:s(()=>[Ie]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["description"]),o(k,{class:"mt-3",description:l.$t("models.index.prefix_desc")},{default:s(()=>[o(P,{modelValue:t(e).prefix,"onUpdate:modelValue":a[4]||(a[4]=p=>t(e).prefix=p)},{default:s(()=>[U(V(l.$t("models.index.prefix")),1)]),_:1},8,["modelValue"])]),_:1},8,["description"]),o(k,{label:l.$t("models.index.fuzzy"),description:l.$t("models.index.fuzzy_desc")},{default:s(()=>[o(f,{modelValue:t(e).fuzzy,"onUpdate:modelValue":a[5]||(a[5]=p=>t(e).fuzzy=p),type:"number",min:"0",step:"0.1"},null,8,["modelValue"])]),_:1},8,["label","description"]),o(k,{class:"mt-3"},{default:s(()=>[o(P,{modelValue:t(e).active,"onUpdate:modelValue":a[6]||(a[6]=p=>t(e).active=p)},{default:s(()=>[U(V(l.$t("models.index.active")),1)]),_:1},8,["modelValue"])]),_:1})])}}}),qe=M({__name:"create",async setup(g){let i,m;const n=x({title:"",fields:[],prefix:!0,fuzzy:.2,context_key:"",active:!0}),e={url:"mgr/indexes",title:_("models.index.title_one"),method:"put"};try{const u=([i,m]=N(()=>F("mgr/modx/contexts",{combo:!0,sort:"rank",limit:1})),i=await i,m(),i);u.rows.length&&(n.value.context_key=u.rows[0].key)}catch{}return(u,d)=>{const c=L;return y(),C(c,E({modelValue:t(n),"onUpdate:modelValue":d[1]||(d[1]=r=>$(n)?n.value=r:null)},e),{"form-fields":s(()=>[o(X,{modelValue:t(n),"onUpdate:modelValue":d[0]||(d[0]=r=>$(n)?n.value=r:null)},null,8,["modelValue"])]),_:1},16,["modelValue"])}}}),Ee=M({__name:"edit",async setup(g){let i,m;const n=x({}),e={url:"mgr/indexes/"+S().params.id,title:_("models.index.title_one"),updateKey:"mgr-indexes",method:"patch"};try{n.value=([i,m]=N(()=>F(e.url)),i=await i,m(),i)}catch(u){console.error(u),Q()}return(u,d)=>{const c=L;return y(),C(c,E({modelValue:t(n),"onUpdate:modelValue":d[1]||(d[1]=r=>$(n)?n.value=r:null)},e),{"form-fields":s(()=>[o(X,{modelValue:t(n),"onUpdate:modelValue":d[0]||(d[0]=r=>$(n)?n.value=r:null)},null,8,["modelValue"])]),_:1},16,["modelValue"])}}}),Fe=M({__name:"view",async setup(g){let i,m;const n=x({}),e={url:"mgr/indexes/"+S().params.id,title:_("models.index.title_one"),updateKey:"mgr-indexes",size:"lg"};try{n.value=([i,m]=N(()=>F(e.url)),i=await i,m(),i)}catch(l){console.error(l),Q()}const u=e.url+"/resources",d=[{key:"resource",label:_("models.index_resource.resource"),sortable:!0},{key:"field",label:_("models.index_resource.field"),sortable:!0},{key:"value",label:_("models.index_resource.value")}],c=x({query:"",field:null}),r=x("resource"),w=x("desc"),b=A(()=>{const l=[];return"fields"in n.value&&Array.isArray(n.value.fields)&&n.value.fields.forEach(a=>{l.push({text:a.field,value:a.field})}),l.length&&l.unshift({text:_("models.index_resource.title_one"),value:null}),l});return(l,a)=>{const f=_e,k=G,R=L;return y(),C(R,E({modelValue:t(n),"onUpdate:modelValue":a[1]||(a[1]=v=>$(n)?n.value=v:null)},e),{default:s(()=>[o(k,J(Y({url:u,fields:d,filters:t(c),sort:t(r),dir:t(w)})),{"header-start":s(()=>[t(b).length?(y(),C(f,{key:0,modelValue:t(c).field,"onUpdate:modelValue":a[0]||(a[0]=v=>t(c).field=v),options:t(b)},null,8,["modelValue","options"])):q("",!0)]),"cell(resource)":s(({value:v})=>[U(V(v.id)+".Â "+V(v.pagetitle),1)]),_:1},16)]),_:1},16,["modelValue"])}}}),Ne=[{name:"index",path:"/",component:Me,children:[{name:"index-create",path:"create",component:qe,props:!0},{name:"index-id-edit",path:":id/edit",component:Ee,props:!0},{name:"index-id-view",path:":id/view",component:Fe,props:!0}],props:!0}];document.addEventListener("DOMContentLoaded",()=>{Z($e).use(ee({history:te(),routes:Ne})).use(oe({namespace:"mmx-search"})).mount("#mmx-search-root")});
