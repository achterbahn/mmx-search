import{d as T,z as y,B as O,g as X,o as c,c as k,i as z,f as x,q as o,w as l,u as t,e as w,h as M,V as le,F as H,p as K,A as R,b as U,a6 as A,m as q,X as ne,ab as se,j as ae,ac as G,G as de,H as ie,y as re}from"./vue-h8ADcOgw.js";import{a as Q,c as ue,b as ce}from"./vue-router-Ca4Y1DuG.js";import{o as W,Q as P,B as J,V as me}from"./vesp-Bb0nMcwX.js";import{w as pe,g as _e,d as fe,A as ve,$ as xe,k as ye,L as Y,e as Ve,f as be,z as ke,X as he,m as ge,v as $e}from"./vue-bootstrap-DwyX2ekl.js";import{E as N,c as f,P as we}from"./api-CqsNYUFk.js";const ze={class:"overflow-auto vh-100 p-3"},Be={class:"d-flex align-items-center gap-1"},Ue={class:"m-0"},Ae={key:0,class:"small text-secondary"},Ce={key:0},Me={class:"small text-secondary"},Re={class:"main-wrapper mb-md-5"},Fe=T({__name:"app",setup($){const s=[{title:"models.index.title_many",route:"index"}],m=y(),a=y();return O(async()=>{try{const e=await N("mgr/version");e.current&&(m.value=e.current),e.available&&(a.value=e.available)}catch{}}),(e,p)=>{const d=pe,v=_e,_=X("RouterView");return c(),k("div",ze,[z("div",Be,[z("h4",Ue,x(e.$t("menu_name")),1),o(le,{name:"fade"},{default:l(()=>[t(m)?(c(),k("div",Ae,[w(x(t(m))+" ",1),t(a)?(c(),k("sup",Ce,x(e.$t("version.available",{version:t(a)})),1)):M("",!0)])):M("",!0)]),_:1})]),z("div",Me,x(e.$t("menu_desc")),1),o(v,{tabs:"",class:"mt-3"},{default:l(()=>[(c(),k(H,null,K(s,(B,h)=>o(d,{key:h,to:{name:B.route}},{default:l(()=>[w(x(e.$t(B.title)),1)]),_:2},1032,["to"])),64))]),_:1}),z("div",Re,[o(_)])])}}}),Ee=($,s)=>{const m=$.__vccOpts||$;for(const[a,e]of s)m[a]=e;return m},Te=Ee(Fe,[["__scopeId","data-v-809b99db"]]),qe={key:0,class:"icon icon-check"},Ie={key:1,class:"icon icon-times"},Ne={class:"text-center my-5"},Le={key:0,class:"mt-5"},De="mgr/indexes",He=T({__name:"index",setup($){const s=y(),m=R(()=>[{route:{name:"index-create"},icon:"plus",title:f("models.index.title_one")}]),a=R(()=>[{key:"id",label:f("models.index.id"),sortable:!0},{key:"title",label:f("models.index.title"),sortable:!0},{key:"prefix",label:f("models.index.prefix"),sortable:!0},{key:"fuzzy",label:f("models.index.fuzzy"),sortable:!0},{key:"context_keys",label:f("models.index.context_keys")}]),e=R(()=>{var u;return[{function:h,icon:"sync",title:f("actions.update")},{route:{name:"index-id-view"},icon:"eye",title:f("actions.view")},{route:{name:"index-id-edit"},icon:"edit",title:f("actions.edit")},{function:(u=s.value)==null?void 0:u.delete,icon:"times",title:f("actions.delete"),variant:"danger"}]}),p=y({query:""}),d=y(!1),v=y(0),_=y(0);function B(u){return u&&!u.active?"inactive":""}async function h(u,V=0){try{d.value=!0;const n=await we("mgr/indexes/"+u.id,{offset:V});v.value=n.total,_.value+=n.indexed,n.total>_.value&&await h(u,_.value),s.value.refresh(),v.value=0,_.value=0}catch{v.value=0,_.value=0}finally{d.value=!1}}return(u,V)=>{const n=X("RouterView"),i=fe,g=ve,b=W;return c(),U(b,q({ref_key:"table",ref:s},{url:De,fields:t(a),headerActions:t(m),tableActions:t(e),filters:t(p),rowClass:B}),{"cell(prefix)":l(({value:C})=>[C?(c(),k("i",qe)):(c(),k("i",Ie))]),"cell(context_keys)":l(({value:C})=>[w(x(C.join(", ")),1)]),default:l(()=>[o(n),o(g,{modelValue:t(d),"onUpdate:modelValue":V[0]||(V[0]=C=>A(d)?d.value=C:null),"teleport-disabled":"","hide-footer":"","hide-header":"","no-close-onbackdrop":""},{default:l(()=>[z("div",Ne,[o(i),t(v)?(c(),k("div",Le,"Indexed "+x(t(_))+" from "+x(t(v)),1)):M("",!0)])]),_:1},8,["modelValue"])]),_:1},16)}}}),Ke={disabled:"",value:""},Pe={key:1,class:"d-flex flex-wrap my-2 gap-1"},Se=z("i",{class:"icon icon-times fa-fw"},null,-1),je=z("i",{class:"icon icon-check fa-fw"},null,-1),Z=T({__name:"index",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup($,{emit:s}){const m=$,a=s,e=R({get(){return m.modelValue},set(n){a("update:modelValue",n)}}),p=y(""),d=y("1"),v=R(()=>p.value.length&&d.value&&e.value.fields.findIndex(n=>n.field===p.value)===-1);function _(){v.value&&(e.value.fields.push({field:p.value,weight:d.value}),p.value="",d.value="1")}function B(n){e.value.fields.splice(n,1)}function h(n){n.key==="Enter"&&(n.preventDefault(),_())}const u=y([]),V=R(()=>u.value.filter(n=>!e.value.context_keys.includes(n.value)));return O(async()=>{try{(await N("mgr/contexts",{combo:!0,sort:"rank"})).rows.forEach(i=>{i.key!=="mgr"&&(u.value.push({text:i.name,value:i.key}),e.value.id||e.value.context_keys.push(i.key))})}catch{}}),(n,i)=>{const g=xe,b=ye,C=Y,ee=Ve,te=be,F=ke,L=he,S=ge,j=$e;return c(),k("div",null,[o(b,{label:n.$t("models.index.title")},{default:l(()=>[o(g,{modelValue:t(e).title,"onUpdate:modelValue":i[0]||(i[0]=r=>t(e).title=r),required:""},null,8,["modelValue"])]),_:1},8,["label"]),o(b,{label:n.$t("models.index.context_keys")},{default:l(()=>[ne(z("input",{"onUpdate:modelValue":i[1]||(i[1]=r=>t(e).context_keys=r),style:{display:"none"},required:""},null,512),[[se,t(e).context_keys]]),t(u).length?(c(),U(te,{key:0,modelValue:t(e).context_keys,"onUpdate:modelValue":i[2]||(i[2]=r=>t(e).context_keys=r),"add-on-change":"","no-outer-focus":""},{default:l(({tags:r,inputAttrs:I,inputHandlers:E,removeTag:oe})=>[t(V).length>0?(c(),U(C,q({key:0},I,{options:t(V)},ae(E)),{first:l(()=>[z("option",Ke,x(n.$t("actions.select_context")),1)]),_:2},1040,["options"])):M("",!0),r.length>0?(c(),k("div",Pe,[(c(!0),k(H,null,K(r,D=>(c(),k("div",{key:D},[o(ee,{variant:"info",onRemove:We=>oe(D)},{default:l(()=>[w(x(D),1)]),_:2},1032,["onRemove"])]))),128))])):M("",!0)]),_:1},8,["modelValue"])):M("",!0)]),_:1},8,["label"]),o(b,{description:n.$t("models.index.field_desc")},{default:l(()=>[o(L,null,{default:l(()=>[o(F,{cols:"6"},{default:l(()=>[w(x(n.$t("models.index.field")),1)]),_:1}),o(F,{cols:"6"},{default:l(()=>[w(x(n.$t("models.index.weight")),1)]),_:1})]),_:1}),(c(!0),k(H,null,K(t(e).fields,(r,I)=>(c(),U(L,{key:I,class:"mt-2"},{default:l(()=>[o(F,{cols:"6"},{default:l(()=>[o(g,{modelValue:r.field,"onUpdate:modelValue":E=>r.field=E,size:"sm",disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(F,{cols:"6",class:"d-flex align-items-center"},{default:l(()=>[o(g,{modelValue:r.weight,"onUpdate:modelValue":E=>r.weight=E,type:"number",size:"sm",min:"1",step:"1"},null,8,["modelValue","onUpdate:modelValue"]),o(S,{size:"sm",class:"ms-2",onClick:E=>B(I)},{default:l(()=>[Se]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),o(L,{class:"mt-2 align-items-center"},{default:l(()=>[o(F,{cols:"6"},{default:l(()=>[o(g,{modelValue:t(p),"onUpdate:modelValue":i[3]||(i[3]=r=>A(p)?p.value=r:null),size:"sm",onKeydown:h},null,8,["modelValue"])]),_:1}),o(F,{cols:"6",class:"d-flex align-items-center"},{default:l(()=>[o(g,{modelValue:t(d),"onUpdate:modelValue":i[4]||(i[4]=r=>A(d)?d.value=r:null),type:"number",size:"sm",min:"1",step:"1",onKeydown:h},null,8,["modelValue"]),o(S,{size:"sm",class:"ms-2",disabled:!t(v),onClick:_},{default:l(()=>[je]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["description"]),o(b,{class:"mt-3",description:n.$t("models.index.prefix_desc")},{default:l(()=>[o(j,{modelValue:t(e).prefix,"onUpdate:modelValue":i[5]||(i[5]=r=>t(e).prefix=r)},{default:l(()=>[w(x(n.$t("models.index.prefix")),1)]),_:1},8,["modelValue"])]),_:1},8,["description"]),o(b,{label:n.$t("models.index.fuzzy"),description:n.$t("models.index.fuzzy_desc")},{default:l(()=>[o(g,{modelValue:t(e).fuzzy,"onUpdate:modelValue":i[6]||(i[6]=r=>t(e).fuzzy=r),type:"number",min:"0",step:"0.1"},null,8,["modelValue"])]),_:1},8,["label","description"]),o(b,{class:"mt-3"},{default:l(()=>[o(j,{modelValue:t(e).active,"onUpdate:modelValue":i[7]||(i[7]=r=>t(e).active=r)},{default:l(()=>[w(x(n.$t("models.index.active")),1)]),_:1},8,["modelValue"])]),_:1})])}}}),Oe=T({__name:"create",setup($){const s=y({title:"",fields:[],prefix:!0,fuzzy:.2,context_keys:[],active:!0}),m={url:"mgr/indexes",title:f("models.index.title_one"),method:"put"};return(a,e)=>{const p=P;return c(),U(p,q({modelValue:t(s),"onUpdate:modelValue":e[1]||(e[1]=d=>A(s)?s.value=d:null)},m),{"form-fields":l(()=>[o(Z,{modelValue:t(s),"onUpdate:modelValue":e[0]||(e[0]=d=>A(s)?s.value=d:null)},null,8,["modelValue"])]),_:1},16,["modelValue"])}}}),Xe=T({__name:"edit",async setup($){let s,m;const a=y({}),e={url:"mgr/indexes/"+Q().params.id,title:f("models.index.title_one"),updateKey:"mgr-indexes",method:"patch"};try{a.value=([s,m]=G(()=>N(e.url)),s=await s,m(),s)}catch(p){console.error(p),J()}return(p,d)=>{const v=P;return c(),U(v,q({modelValue:t(a),"onUpdate:modelValue":d[1]||(d[1]=_=>A(a)?a.value=_:null)},e),{"form-fields":l(()=>[o(Z,{modelValue:t(a),"onUpdate:modelValue":d[0]||(d[0]=_=>A(a)?a.value=_:null)},null,8,["modelValue"])]),_:1},16,["modelValue"])}}}),Ge=T({__name:"view",async setup($){let s,m;const a=y({}),e={url:"mgr/indexes/"+Q().params.id,title:f("models.index.title_one"),updateKey:"mgr-indexes",size:"lg"};try{a.value=([s,m]=G(()=>N(e.url)),s=await s,m(),s)}catch(u){console.error(u),J()}const p=e.url+"/resources",d=[{key:"resource",label:f("models.index_resource.resource"),sortable:!0},{key:"field",label:f("models.index_resource.field"),sortable:!0},{key:"value",label:f("models.index_resource.value")}],v=y({query:"",field:null}),_=y("resource"),B=y("desc"),h=R(()=>{const u=[];return"fields"in a.value&&Array.isArray(a.value.fields)&&a.value.fields.forEach(V=>{u.push({text:V.field,value:V.field})}),u.length&&u.unshift({text:f("models.index_resource.title_one"),value:null}),u});return(u,V)=>{const n=Y,i=W,g=P;return c(),U(g,q({modelValue:t(a),"onUpdate:modelValue":V[1]||(V[1]=b=>A(a)?a.value=b:null)},e),{default:l(()=>[o(i,de(ie({url:p,fields:d,filters:t(v),sort:t(_),dir:t(B)})),{"header-start":l(()=>[t(h).length?(c(),U(n,{key:0,modelValue:t(v).field,"onUpdate:modelValue":V[0]||(V[0]=b=>t(v).field=b),options:t(h)},null,8,["modelValue","options"])):M("",!0)]),"cell(resource)":l(({value:b})=>[w(x(b.id)+".Â "+x(b.pagetitle),1)]),_:1},16)]),_:1},16,["modelValue"])}}}),Qe=[{name:"index",path:"/",component:He,children:[{name:"index-create",path:"create",component:Oe,props:!0},{name:"index-id-edit",path:":id/edit",component:Xe,props:!0},{name:"index-id-view",path:":id/view",component:Ge,props:!0}],props:!0}];document.addEventListener("DOMContentLoaded",()=>{re(Te).use(ue({history:ce(),routes:Qe})).use(me({namespace:"mmx-search"})).mount("#mmx-search-root")});
